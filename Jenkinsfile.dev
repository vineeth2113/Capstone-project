pipeline {
    agent any

    environment {
          Dev_ImageName="vineeth/capstone-dev:latest"
        }
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        stage('build') {
            steps {
                script{
                    sh 'chmod +x build.sh'
                    sh './build.sh'
                }
            }
        }
        stage('push the image to dev repository') {
            steps {
                script{
                    withCredentials([usernamePassword(passwordVariable: 'Dockerhub_password', usernameVariable: 'Dockerhub_Username')]) {
                        sh 'docker login -u $Dockerhub_Username -p $Dockerhub_password'
                        sh 'docker images'
                        sh 'docker push ${Dev_ImageName}'
                        sh 'docker logout'
                    }
                }
            }
        }
    }
post {
        success {
            echo 'The image successfully pushed to the Development repository'
        }
        failure {
            echo 'Pipefile failed'
        }
    }
}

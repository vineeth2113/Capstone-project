pipeline {
    agent any

    environment {
            Dev_ImageName="vineeth/capstone-dev:latest"
        }
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        stage('build') {
            steps {
                script{
                    sh 'chmod +x build.sh'
                    sh './build.sh'
                }
            }
        }
        stage('push the image to dev repository') {
            steps {
                script{
                    withCredentials([usernamePassword(credentialsId: 'DockerCred', passwordVariable: 'DOCKERHUB_PASSWORD', usernameVariable: 'DOCKERHUB_USERNAME')])  {
                        sh 'docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD'
                        sh 'docker images'
                        sh 'docker push ${Dev_ImageName}'
                        sh 'docker logout'
                    }
                }
            }
        }
    }
post {
        success {
            echo 'The image successfully pushed to the Development repository'
        }
        failure {
            echo 'Pipefile failed'
        }
    }
}
